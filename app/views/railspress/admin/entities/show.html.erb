<% content_for :title, entity_config.singular_label %>

<%
  # Separate focal point images from other fields for special display
  focal_point_fields = entity_config.fields.select { |_, f| f[:type] == :focal_point_image }
  other_fields = entity_config.fields.reject { |_, f| f[:type] == :focal_point_image }
%>

<div class="rp-page-header">
  <h1 class="rp-page-title"><%= entity_config.singular_label %></h1>
  <div class="rp-page-actions">
    <%= link_to "Edit", entity_edit_path(@record), class: "rp-btn rp-btn--primary" %>
    <%= link_to "Back to #{entity_config.label}", entity_index_path, class: "rp-btn rp-btn--secondary" %>
  </div>
</div>

<%# Display focal point images prominently before the detail card %>
<% focal_point_fields.each do |name, field| %>
  <% attachment = @record.public_send(name) %>
  <% if attachment.attached? %>
    <div class="rp-card rp-card--padded rp-image-section-card">
      <%= render "railspress/admin/shared/image_section_compact",
            record: @record,
            attachment_name: name,
            label: name.to_s.humanize %>
    </div>
  <% end %>
<% end %>

<div class="rp-card">
  <dl class="rp-detail-list">
    <% other_fields.each do |name, field| %>
      <div class="rp-detail-item">
        <dt class="rp-detail-label"><%= name.to_s.humanize %></dt>
        <dd class="rp-detail-value">
          <% value = @record.public_send(name) %>
          <% case field[:type] %>
          <% when :rich_text %>
            <div class="rp-rich-text-content">
              <%= value %>
            </div>
          <% when :boolean %>
            <span class="rp-badge rp-badge--<%= value ? 'published' : 'draft' %>">
              <%= value ? "Yes" : "No" %>
            </span>
          <% when :datetime %>
            <%= value&.strftime("%B %d, %Y at %I:%M %p") || "—" %>
          <% when :date %>
            <%= value&.strftime("%B %d, %Y") || "—" %>
          <% when :text %>
            <div class="rp-text-content"><%= simple_format(value) %></div>
          <% when :list %>
            <% if value.is_a?(Array) && value.any? %>
              <span class="rp-list-inline"><%= value.join(", ") %></span>
            <% else %>
              <span class="rp-text-muted">—</span>
            <% end %>
          <% when :lines %>
            <% if value.is_a?(Array) && value.any? %>
              <ul class="rp-list-block">
                <% value.each do |item| %>
                  <li><%= item %></li>
                <% end %>
              </ul>
            <% else %>
              <span class="rp-text-muted">—</span>
            <% end %>
          <% when :attachments %>
            <% if value.attached? %>
              <div class="rp-gallery-grid">
                <% value.each do |attachment| %>
                  <div class="rp-gallery-grid-item">
                    <% if attachment.image? %>
                      <%= link_to main_app.url_for(attachment), target: "_blank" do %>
                        <%= image_tag main_app.url_for(attachment), class: "rp-gallery-grid-image" %>
                      <% end %>
                    <% else %>
                      <%= link_to attachment.filename, main_app.url_for(attachment), class: "rp-link" %>
                    <% end %>
                  </div>
                <% end %>
              </div>
            <% else %>
              <span class="rp-text-muted">No images</span>
            <% end %>
          <% when :attachment %>
            <% if value.attached? %>
              <div class="rp-attachment-display">
                <% if value.image? %>
                  <%= link_to main_app.url_for(value), target: "_blank" do %>
                    <%= image_tag main_app.url_for(value), class: "rp-attachment-image" %>
                  <% end %>
                <% else %>
                  <%= link_to value.filename, main_app.url_for(value), class: "rp-link" %>
                <% end %>
              </div>
            <% else %>
              <span class="rp-text-muted">No file attached</span>
            <% end %>
          <% else %>
            <%= value.presence || "—" %>
          <% end %>
        </dd>
      </div>
    <% end %>

    <div class="rp-detail-item">
      <dt class="rp-detail-label">Created</dt>
      <dd class="rp-detail-value"><%= @record.created_at.strftime("%B %d, %Y at %I:%M %p") %></dd>
    </div>

    <div class="rp-detail-item">
      <dt class="rp-detail-label">Updated</dt>
      <dd class="rp-detail-value"><%= @record.updated_at.strftime("%B %d, %Y at %I:%M %p") %></dd>
    </div>
  </dl>
</div>
